---
/**
 * Custom Landing Page Layout
 * 
 * This layout provides the Starlight Header without the full page layout,
 * allowing for full-width content without centered constraints or page titles.
 * 
 * It mocks the minimal starlightRoute properties needed for the Header component.
 */

// Import Starlight styles - same order as Page.astro
// User CSS first so it can override cascade layers order
import 'virtual:starlight/user-css'

// Starlight internal styles (using absolute paths resolved by Vite)
import 'node_modules/@astrojs/starlight/style/layers.css'
import 'node_modules/@astrojs/starlight/style/props.css'
import 'node_modules/@astrojs/starlight/style/reset.css'
import 'node_modules/@astrojs/starlight/style/util.css'

// @ts-expect-error - Virtual modules are resolved at build time by Starlight
import config from 'virtual:starlight/user-config'
// @ts-expect-error - Virtual modules are resolved at build time by Starlight
import ThemeProvider from 'virtual:starlight/components/ThemeProvider'

import Header from '../components/overrides/Header.astro'
import { pathWithBase } from '../util/links'

interface Props {
  title: string
  description?: string
}

const { title, description } = Astro.props

// Get base path for site title href
const siteTitleHref = pathWithBase('/')

// Mock the minimal starlightRoute data needed for the Header component
const mockStarlightRoute = {
  siteTitle: config.title || 'Strands Agents SDK',
  siteTitleHref,
  lang: 'en',
  dir: 'ltr' as const,
  locale: undefined,
  // Minimal entry data
  entry: {
    id: 'index',
    slug: '',
    data: {
      title,
      description,
      pagefind: false,
      template: 'splash',
    },
  },
  entryMeta: {
    lang: 'en',
    dir: 'ltr' as const,
    locale: undefined,
  },
  // Empty sidebar since landing page doesn't need it
  sidebar: [],
  hasSidebar: false,
  headings: [],
  pagination: { prev: undefined, next: undefined },
  toc: undefined,
  lastUpdated: undefined,
  editUrl: undefined,
  id: 'index',
  slug: '',
  head: [],
}

// Set the starlightRoute on Astro.locals for components that need it
// @ts-expect-error - We're mocking the route data
Astro.locals.starlightRoute = mockStarlightRoute

// Mock the translation function that Starlight components use
// This needs to be a function with an `all()` method for the Search component
const translations: Record<string, string> = {
  'sidebarNav.accessibleLabel': 'Main navigation',
  'skipLink.label': 'Skip to content',
  'search.label': 'Search',
  'search.ctrlKey': 'Ctrl',
  'search.cancelLabel': 'Cancel',
  'themeSelect.accessibleLabel': 'Select theme',
  'themeSelect.dark': 'Dark',
  'themeSelect.light': 'Light',
  'themeSelect.auto': 'Auto',
  'menuButton.accessibleLabel': 'Menu',
}

const mockT = (key: string) => translations[key] || key
mockT.all = () => translations

// @ts-expect-error - We're mocking the translation function
Astro.locals.t = mockT
---

<!doctype html>
<html lang="en" dir="ltr" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
    {description && <meta name="description" content={description} />}
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href={pathWithBase('/favicon.svg')} />
    
    <!-- Figtree Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Figtree:wght@400;500;600;700&display=swap" rel="stylesheet" />
    
    <!-- Open Graph -->
    <meta property="og:title" content={title} />
    {description && <meta property="og:description" content={description} />}
    <meta property="og:type" content="website" />
    
    <ThemeProvider />
    
    <style is:global>
      /* Landing page specific styles */
      .landing-header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: var(--sl-z-index-navbar);
        height: var(--sl-nav-height);
        padding: var(--sl-nav-pad-y) var(--sl-nav-pad-x);
        background-color: var(--sl-color-bg-nav);
        border-bottom: 1px solid var(--sl-color-hairline-shade);
      }
      
      .landing-main {
        padding-top: var(--sl-nav-height);
        min-height: 100vh;
      }
    </style>
  </head>
  <body>
    <header class="landing-header">
      <Header />
    </header>
    <main class="landing-main">
      <slot />
    </main>
  </body>
</html>
