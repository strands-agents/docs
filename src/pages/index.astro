---
/**
 * Custom Landing Page for Strands Agents SDK
 * 
 * This page uses a custom layout with the Starlight Header but without
 * the full page layout, allowing for full-width content.
 */
import { getCollection } from 'astro:content'
import LandingLayout from '../layouts/LandingLayout.astro'
import logoHeaderDark from '../assets/logo-header-dark.svg'
import logoHeaderLight from '../assets/logo-header-light.svg'
import curvePrimary from '../assets/curve-primary.svg'
import curveSecondary from '../assets/curve-secondary.svg'
import iconZap from '../assets/icons/icon-zap.svg?raw'
import iconBot from '../assets/icons/icon-bot.svg?raw'
import iconLayers from '../assets/icons/icon-layers.svg?raw'
import iconBolt from '../assets/icons/icon-bolt.svg?raw'

// Get base path for links
const base = import.meta.env.BASE_URL || '/'
const withBase = (path: string) => {
  const normalizedBase = base.endsWith('/') ? base.slice(0, -1) : base
  return normalizedBase + path
}

// Features data
const features = [
  {
    icon: iconZap,
    title: "Model driven orchestration",
    description: "Strands leverages model reasoning to plan, orchestrate tasks, and reflect on goals",
  },
  {
    icon: iconBot,
    title: "Model & provider agnostic",
    description: "Work with any LLM provider - Amazon Bedrock, OpenAI, Anthropic, local models. Switch providers without changing your code.",
  },
  {
    icon: iconLayers,
    title: "Simple multi-agent primitives",
    description: "Simple primitives for handoffs, swarms, and graph workflows with built-in support for A2A",
  },
  {
    icon: iconBolt,
    title: "Best in-class AWS integrations",
    description: "Native tools for AWS service interactions. Deploy easily into Bedrock AgentCore, EKS, Lambda, EC2, and more.",
  },
]

// Testimonials from content collection
const testimonialEntries = await getCollection('testimonials')
const testimonials = testimonialEntries
  .sort((a, b) => a.data.order - b.data.order)
  .map(entry => entry.data)
---

<LandingLayout 
  title="Strands Agents SDK" 
  description="Build production-ready, multi-agent AI systems in a few lines of code"
>
  <!-- Animated Curves Background -->
  <div class="strands-curves-container">
    <div class="strands-curve-secondary" style={`background-image: url(${curveSecondary.src})`}></div>
    <div class="strands-curve-primary" style={`background-image: url(${curvePrimary.src})`}></div>
  </div>

  <div class="landing-page">
    <!-- Hero Section with Parallax -->
    <section class="hero-section">
      <div class="hero-background"></div>
      <div class="hero-content">
        <h1 class="hero-title">
          Build production-ready,<br />
          multi-agent AI systems<br />
          <span class="hero-highlight">in a few lines of code</span>
        </h1>
        <div class="hero-cta">
          <a href={withBase('/user-guide/quickstart/overview/')} class="cta-button primary">Get Started</a>
        </div>
      </div>
    </section>

    <!-- Features Section -->
    <section class="features-section">
      <div class="features-grid">
        {features.map((feature) => (
          <div class="feature-card">
            <div class="feature-icon" set:html={feature.icon} />
            <h3 class="feature-title">{feature.title}</h3>
            <p class="feature-description">{feature.description}</p>
          </div>
        ))}
      </div>
    </section>

    <!-- Testimonials Section -->
    <section class="testimonials-section">
      <!-- Slider Dots above container -->
      <div class="slider-dots" id="slider-dots"></div>
      
      <div class="testimonials-container">
        <div class="testimonials-slider" id="testimonials-slider">
          {testimonials.map((testimonial, index) => (
            <div class={`testimonial-slide ${index === 0 ? 'active' : ''}`}>
              <blockquote class="testimonial-quote">
                "{testimonial.quote}"
              </blockquote>
              <div class="testimonial-author">
                <div class="author-info">
                  <span class="author-name">{testimonial.name}</span>
                  {testimonial.title && <span class="author-title">{testimonial.title}</span>}
                </div>
                {testimonial.icon && <img src={testimonial.icon} alt="" class="author-icon" />}
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>
  </div>
</LandingLayout>

<style>
  /* Animated Curves Background */
  .strands-curves-container {
    position: fixed;
    top: var(--sl-nav-height);
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    pointer-events: none;
    filter: blur(4px);
    overflow: hidden;
  }

  .strands-curve-secondary {
    background-repeat: repeat-y;
    height: 200vw;
    width: 291px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) rotate(110deg) scale(2);
    animation: scroll-secondary 90s linear infinite;
    z-index: -1;
  }

  .strands-curve-primary {
    background-repeat: repeat-y;
    height: 200vw;
    width: 290px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) rotate(110deg) scale(1.5);
    animation: scroll-primary 36s linear infinite;
  }

  @keyframes scroll-primary {
    0% { background-position: 0 0; }
    100% { background-position: 0 -344px; }
  }

  @keyframes scroll-secondary {
    0% { background-position: 0 0; }
    100% { background-position: 0 -344px; }
  }

  .landing-page {
    --strands-green: #00cc5f;
    --strands-green-bright: #00FF77;
    --strands-green-hover: #00D965;
    --strands-dark: #0E0E0E;
    width: 100%;
    background: transparent;
  }

  .hero-section {
    position: relative;
    min-height: 60vh;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    padding: 2rem;
  }

  .hero-background {
    position: absolute;
    inset: 0;
    background: 
      radial-gradient(ellipse at 30% 20%, rgba(0, 204, 95, 0.15) 0%, transparent 50%),
      radial-gradient(ellipse at 70% 80%, rgba(0, 255, 119, 0.1) 0%, transparent 50%);
    z-index: 0;
  }

  @supports (animation-timeline: scroll()) {
    .hero-background {
      animation: parallax-bg linear;
      animation-timeline: scroll();
    }
    @keyframes parallax-bg {
      from { transform: translateY(0); }
      to { transform: translateY(30%); }
    }
  }

  .hero-content {
    position: relative;
    z-index: 1;
    text-align: left;
    width: 100%;
    max-width: 1200px;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(50px);
    -webkit-backdrop-filter: blur(50px);
    border-radius: 16px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    padding: 3rem;
    margin: 0 2rem;
  }
  :global([data-theme='dark']) .hero-content {
    background: rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  }
  .hero-title {
    font-family: 'Figtree', sans-serif;
    font-size: clamp(2rem, 5vw, 4rem);
    font-weight: 500;
    line-height: 1.1;
    margin-bottom: 1.5rem;
    color: var(--sl-color-white);
    letter-spacing: -0.03em;
  }

  .hero-highlight {
    font-weight: 600;
  }

  .hero-cta { display: flex; gap: 1rem; justify-content: flex-start; flex-wrap: wrap; }

  .cta-button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.875rem 2rem;
    font-size: 1rem;
    font-weight: 600;
    text-decoration: none;
    border-radius: 8px;
    transition: all 0.2s ease;
  }

  .cta-button.primary { background: var(--strands-green); color: var(--strands-dark); }
  .cta-button.primary:hover {
    background: var(--strands-green-bright);
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(0, 204, 95, 0.4);
    color: var(--strands-dark);
  }

  .cta-button.secondary {
    background: transparent;
    color: var(--sl-color-white);
    border: 2px solid var(--sl-color-gray-4);
  }
  .cta-button.secondary:hover { border-color: var(--strands-green); color: var(--strands-green); }
  .cta-button.large { padding: 1rem 2.5rem; font-size: 1.125rem; }

  .features-section { padding: 2rem; background: transparent; }
  .features-grid {
    display: flex;
    gap: 1.5rem;
    max-width: 1200px;
    margin: 0 auto;
    justify-content: center;
    flex-wrap: wrap;
  }

  .feature-card {
    position: relative;
    min-width: 200px;
    height: 140px;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(50px);
    -webkit-backdrop-filter: blur(50px);
    border-radius: 16px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    transition: flex 0.5s ease;
    padding: 1.25rem;
    flex: 1;
    overflow: hidden;
  }
  :global([data-theme='dark']) .feature-card {
    background: rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  }
  .feature-card:hover {
    flex: 1.5;
  }

  .feature-icon {
    margin-bottom: 0.75rem;
    transition: transform 0.5s ease;
    transition-delay: 0.25s;
    color: var(--sl-color-gray-3);
  }
  .feature-icon :global(svg) {
    width: 28px;
    height: 28px;
  }
  .feature-card:hover .feature-icon {
    transform: scale(0);
    transition-delay: 0s;
  }

  .feature-title {
    font-family: 'Figtree', sans-serif;
    font-size: 1.125rem;
    font-weight: 400;
    text-align: center;
    color: var(--sl-color-white);
    margin: 0;
    transition: transform 0.5s ease;
    transition-delay: 0.25s;
    max-width: 160px;
    line-height: 1.2;
  }
  .feature-card:hover .feature-title {
    transform: scale(0);
    transition-delay: 0s;
  }

  .feature-description {
    position: absolute;
    color: var(--sl-color-white);
    font-family: 'Figtree', sans-serif;
    font-size: 1rem;
    font-weight: 400;
    line-height: 1.5;
    text-align: center;
    margin: 0;
    padding: 0 1rem;
    transform: scale(0);
    transition: transform 0.5s ease;
    transition-delay: 0s;
  }
  .feature-card:hover .feature-description {
    transform: scale(1);
    transition-delay: 0.25s;
  }

  /* Responsive: stack on mobile */
  @media (max-width: 768px) {
    .features-grid {
      flex-direction: column;
    }
    .feature-card {
      flex: none;
      width: 100%;
      min-width: unset;
    }
    .feature-card:hover {
      flex: none;
    }
  }

  .testimonials-section {
    padding: 3rem 2rem;
    background: transparent;
    /* Set min-height to avoid different quotes from changing the page height */
    min-height: 600px;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
  }
  .testimonials-container {
    max-width: 900px;
    width: 100%;
    margin: 0 auto;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(50px);
    -webkit-backdrop-filter: blur(50px);
    border-radius: 16px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    padding: 1.5rem 2rem 2rem;
  }
  :global([data-theme='dark']) .testimonials-container {
    background: rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  }
  .testimonials-slider {
    position: relative;
    transition: height 0.5s ease-in-out;
  }

  .testimonial-slide {
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 1rem 0;
    opacity: 0;
    visibility: hidden;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
    pointer-events: none;
  }
  .testimonial-slide.active {
    opacity: 1;
    visibility: visible;
    position: relative;
    pointer-events: auto;
  }

  .testimonial-quote {
    font-family: 'Figtree', sans-serif;
    font-size: clamp(1.125rem, 2.5vw, 1.5rem);
    font-weight: 400;
    line-height: 1.5;
    color: var(--sl-color-white);
    margin: 0 0 2rem 0;
    padding: 0;
    border: none;
    font-style: italic;
    text-align: center;
  }

  .testimonial-author {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
  }
  .author-icon {
    width: 48px;
    height: 48px;
    object-fit: contain;
    flex-shrink: 0;
  }
  .author-info {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
  }
  .author-name {
    font-family: 'Figtree', sans-serif;
    font-weight: 600;
    color: var(--sl-color-white);
    font-size: 1.1rem;
  }
  .author-title {
    font-family: 'Figtree', sans-serif;
    color: var(--sl-color-gray-3);
    font-size: 0.9rem;
    margin-top: 0.25rem;
  }

  .slider-dots { display: flex; gap: 0.75rem; justify-content: center; margin-bottom: 1.5rem; }

  :global(.slider-dot) {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: rgba(183, 183, 183, 0.3);
    border: none;
    padding: 0;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  :global(.slider-dot.active) { background: var(--strands-green); }
  :global(.slider-dot:hover) { background: var(--strands-green-hover); }

  .cta-section { padding: 3rem 2rem; text-align: center; background: transparent; }
  .cta-section h2 {
    font-family: 'Figtree', sans-serif;
    font-size: clamp(1.5rem, 4vw, 2.5rem);
    font-weight: 700;
    margin-bottom: 2rem;
    color: var(--sl-color-white);
  }
  .cta-buttons { display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; }

  @media (max-width: 768px) {
    .hero-section { min-height: 50vh; padding: 1.5rem; }
    .features-section, .testimonials-section, .cta-section { padding: 2rem 1.5rem; }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const slider = document.querySelector<HTMLElement>('.testimonials-slider')
    const slides = document.querySelectorAll<HTMLElement>('.testimonial-slide')
    const dotsContainer = document.getElementById('slider-dots')
    
    if (!slides.length || !dotsContainer || !slider) return
    
    let currentIndex = 0
    let autoplayInterval: number | undefined
    
    // Set initial height after a brief delay to ensure layout is complete
    requestAnimationFrame(() => {
      const activeSlide = slides[0]
      if (activeSlide && slider) {
        slider.style.height = `${activeSlide.offsetHeight}px`
      }
    })
    
    slides.forEach((_, index) => {
      const dot = document.createElement('button')
      dot.className = `slider-dot ${index === 0 ? 'active' : ''}`
      dot.setAttribute('aria-label', `Go to testimonial ${index + 1}`)
      dot.addEventListener('click', () => goToSlide(index))
      dotsContainer.appendChild(dot)
    })
    
    const dots = dotsContainer.querySelectorAll<HTMLButtonElement>('.slider-dot')
    
    function goToSlide(index: number) {
      const oldSlide = slides[currentIndex]
      const newIndex = (index + slides.length) % slides.length
      const newSlide = slides[newIndex]
      
      if (oldSlide) {
        oldSlide.classList.remove('active')
      }
      dots[currentIndex]?.classList.remove('active')
      
      currentIndex = newIndex
      
      if (newSlide && slider) {
        newSlide.classList.add('active')
        // Use requestAnimationFrame to ensure the new slide is rendered before measuring
        requestAnimationFrame(() => {
          slider.style.height = `${newSlide.offsetHeight}px`
        })
      }
      dots[currentIndex]?.classList.add('active')
      
      if (autoplayInterval) clearInterval(autoplayInterval)
      startAutoplay()
    }
    
    function startAutoplay() {
      autoplayInterval = window.setInterval(() => goToSlide(currentIndex + 1), 6000)
    }
    
    startAutoplay()
    
    const container = document.querySelector('.testimonials-container')
    container?.addEventListener('mouseenter', () => { if (autoplayInterval) clearInterval(autoplayInterval) })
    container?.addEventListener('mouseleave', startAutoplay)
  })
</script>
